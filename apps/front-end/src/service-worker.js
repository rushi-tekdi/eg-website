// service-worker.js

import { precacheAndRoute } from "workbox-precaching";

// Precache all of the assets generated by your build process.
// Their URLs are injected into the manifest variable below.
// This variable must be present somewhere in your service worker file,
// even if you decide not to use precaching. See https://cra.link/PWA
precacheAndRoute(self.__WB_MANIFEST);

const CACHE_NAME = "eg-pragati-cache-v1";

self.addEventListener("install", function (event) {
  event.waitUntil(
    caches.open(CACHE_NAME).then(function (cache) {
      return cache.addAll([
        "/index.html?version=1", // Append a version query parameter
        "/styles/main.css",
        "/scripts/main.js",
        // Add other assets to cache
      ]);
    })
  );
});

self.addEventListener("fetch", function (event) {
  event.respondWith(
    caches.match(event.request).then(function (response) {
      // Cache-first strategy
      return response || fetch(event.request);
    })
  );
});

self.addEventListener("activate", function (event) {
  event.waitUntil(self.clients.claim());
});

self.addEventListener("fetch", function (event) {
  // Cache-busting for index.html
  if (event.request.url.endsWith("/index.html")) {
    event.respondWith(
      caches.match(event.request.url + "?v=2").then(function (response) {
        return response || fetch(event.request);
      })
    );
  } else {
    event.respondWith(
      caches.match(event.request).then(function (response) {
        // Cache-first strategy
        return response || fetch(event.request);
      })
    );
  }
});
